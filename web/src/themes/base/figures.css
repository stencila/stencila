/* Figure styles
 *
 * Schema: [Figure](../../schema/Figure.yaml)
 * Purpose: Container for figures with content (typically images) and optional captions.
 *
 * DOM Structure:
 * <stencila-figure id=xxx depth=N ancestors=Parent label=X label-automatically=false>
 *     <figure slot=content>
 *         <stencila-image-object id=xxx depth=N+1 ancestors=Parent.Figure content-url='https://example.org/image.jpg'>
 *             <img src='https://example.org/image.jpg'/>
 *         </stencila-image-object>
 *         <figcaption>
 *             <stencila-paragraph id=xxx depth=N+1 ancestors=Parent.Figure>
 *                 <p slot=content>
 *                     <span class=figure-label>Figure 2</span>: <stencila-text id=xxx depth=N+2 ancestors=Parent.Figure.Paragraph>Caption text.</stencila-text>
 *                 </p>
 *             </stencila-paragraph>
 *         </figcaption>
 *     </figure>
 * </stencila-figure>
 *
 * Key Attributes:
 * - label: Figure number (e.g., "2")
 * - label-automatically: Boolean indicating if label was auto-generated
 *
 * Slots:
 * - content: Contains the figure element with media content and optional caption
 *
 * Notes:
 * - Figures can contain various media objects (images, videos, etc.)
 * - Caption includes a figure label styled with --figure-label-* tokens
 * - Labels can be automatically generated or manually specified
 * - Container styling (background, border) defaults to transparent/minimal
 *   but can be customized for visual isolation similar to quote blocks
 *
 * Examples: examples/conversion/figure/figure.dom.html
 * Documentation: docs/themes/figures.smd
 */

:root {
    /* Spacing tokens - vertical separation from surrounding content */
    --figure-spacing-top: var(--content-spacing);
    --figure-spacing-bottom: var(--content-spacing);

    /* Container styling - optional visual isolation */
    --figure-background: transparent;
    --figure-background-dark: transparent;
    --figure-background-print: transparent;

    --figure-border-width: 0;
    --figure-border-color: var(--border-color-subtle);
    --figure-border-color-dark: var(--border-color-subtle-dark);
    --figure-border-color-print: var(--border-color-default-print);
    --figure-border-radius: var(--border-radius-default);

    --figure-padding: 0;

    /* Content layout - positioning and constraints */
    --figure-content-display: block;
    --figure-content-max-width: 100%;
    --figure-content-margin-horizontal: auto;

    /* Caption typography - inherits from caption tokens */
    --figure-caption-font-family: var(--caption-font-family);
    --figure-caption-font-size: var(--caption-font-size);
    --figure-caption-color: var(--caption-color);
    --figure-caption-spacing-top: var(--caption-spacing);
    --figure-caption-line-height: var(--caption-line-height);
    --figure-caption-align: var(--caption-align);
    --figure-caption-max-width: var(--caption-max-width);

    /* Label styling - inherits from semantic label tokens */
    --figure-label-font-weight: var(--label-font-weight);
    --figure-label-font-style: var(--label-font-style);
    --figure-label-color: var(--label-color);
}

/* Dark Mode Application - System Preference */
@media (prefers-color-scheme: dark) {
    :root:not([data-color-scheme="light"]) {
        --figure-background: var(--figure-background-dark);
        --figure-border-color: var(--figure-border-color-dark);
    }
}

/* Dark Mode Application - Explicit User Choice */
:root[data-color-scheme="dark"] {
    --figure-background: var(--figure-background-dark);
    --figure-border-color: var(--figure-border-color-dark);
}

stencila-figure {
    display: block;

    /* Vertical spacing */
    margin-top: var(--figure-spacing-top);
    margin-bottom: var(--figure-spacing-bottom);

    figure {
        /* Browser normalization */
        margin: 0;

        /* Optional container styling */
        background-color: var(--figure-background);
        border: var(--figure-border-width) solid var(--figure-border-color);
        border-radius: var(--figure-border-radius);
        padding: var(--figure-padding);

        /* Content layout */
        display: var(--figure-content-display);
        max-width: var(--figure-content-max-width);
        margin-left: var(--figure-content-margin-horizontal);
        margin-right: var(--figure-content-margin-horizontal);
    }

    figcaption {
        /* Caption spacing and layout */
        margin-top: var(--figure-caption-spacing-top);
        max-width: var(--figure-caption-max-width);

        stencila-paragraph p {
            /* Caption typography */
            font-family: var(--figure-caption-font-family);
            font-size: var(--figure-caption-font-size);
            color: var(--figure-caption-color);
            line-height: var(--figure-caption-line-height);
            text-align: var(--figure-caption-align);
        }

        /* Paragraph spacing: first paragraph aligns with figcaption,
         * subsequent paragraphs use caption spacing to maintain visual hierarchy */
        stencila-paragraph:first-child {
            margin-top: 0;
        }

        stencila-paragraph:not(:first-child) {
            margin-top: var(--figure-caption-spacing-top);
        }

        /* Label styling within caption */
        .figure-label {
            font-weight: var(--figure-label-font-weight);
            font-style: var(--figure-label-font-style);
            color: var(--figure-label-color);
        }
    }
}

/* Print Media Optimization */
@media print {
    :root {
        --figure-background: var(--figure-background-print);
        --figure-border-color: var(--figure-border-color-print);
    }

    stencila-figure {
        figure {
            /* Prevent figures from breaking across pages */
            page-break-inside: avoid;
            break-inside: avoid;
        }
    }
}