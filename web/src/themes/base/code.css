/* Code styles
 *
 * Schema: [CodeBlock](../../schema/CodeBlock.yaml) [CodeInline](../../schema/CodeInline.yaml)
 * Purpose: Source code in both block and inline contexts, with syntax highlighting support.
 *
 * DOM Structure (Block):
 * <stencila-code-block id=xxx depth=N ancestors=Parent code='# Python code\nprint("hello")' programming-language=python>
 *     <pre>
 *         <code># Python code
 * print("hello")</code>
 *     </pre>
 * </stencila-code-block>
 *
 * DOM Structure (Inline):
 * <stencila-code-inline id=xxx depth=N ancestors=Parent code='print("hello")' programming-language=python>
 *     <code>print("hello")</code>
 * </stencila-code-inline>
 *
 * Key Attributes:
 * - code: The source code string (from [CodeStatic](../../schema/CodeStatic.yaml))
 * - programming-language: Language identifier (e.g., python, javascript, r)
 *
 * Slots:
 * - None (CodeBlock renders <pre><code>, CodeInline renders <code>)
 *
 * Notes:
 * - CodeBlock and CodeInline are static (non-executable) code nodes
 * - When JavaScript loads, CodeMirror is instantiated for syntax highlighting
 * - Editor tokens (--code-caret-color, --code-gutter-*, etc.) only apply with CodeMirror
 * - Syntax highlighting tokens (--code-comment, --code-keyword, etc.) work for both static and CodeMirror views
 * - For executable code, see CodeChunk and CodeExpression (separate styling)
 * - CodeMirror theme integration: web/src/ui/nodes/properties/code/theme.ts
 *
 * Examples: examples/conversion/code-block/code-block.dom.html
 *           examples/conversion/code-inline/code-inline.dom.html
 */

:root {
    /* Font and Typography */
    --code-color: var(--text-color-primary);
    --code-color-dark: #e8e8e8;
    --code-font-family: var(--font-family-mono);
    --code-font-size-inline: var(--font-size-sm);
    --code-font-size-block: var(--font-size-sm);
    --code-line-height: 150%;

    /* Visual Style
     *
     * Backgrounds use a subtle darkening of the surface background (5% black/white mix)
     * to create a tinted effect that harmonizes with any theme's background color. */
    --code-background: color-mix(in srgb, black 5%, var(--surface-background));
    --code-background-dark: color-mix(in srgb, white 5%, var(--surface-background-dark));
    --code-background-inline: var(--code-background);
    --code-background-inline-dark: var(--code-background-dark);
    --code-background-block: var(--code-background);
    --code-border-color: var(--border-color-muted);
    --code-border-color-dark: #404040;
    --code-border-width: var(--border-width-default);
    --code-border-radius: var(--radius-sm);

    /* Spacing */
    --code-spacing: var(--content-spacing);
    --code-padding-inline: 0.05em 0.25em;
    --code-padding-block: var(--space-4);

    /* CodeMirror Editor */
    --code-caret-color: var(--text-color-primary);
    --code-caret-color-dark: #e8e8e8;
    --code-selection-background: var(--color-blue-200);
    --code-selection-background-dark: #1a3a5c;
    --code-selection-match-background: var(--color-blue-100);
    --code-selection-match-background-dark: #2d4f70;
    --code-focused-background: var(--code-background);
    --code-focused-background-dark: #2a2a2a;
    --code-cursor-line-background: rgba(0, 0, 0, 0.02);
    --code-cursor-line-background-dark: rgba(255, 255, 255, 0.05);
    --code-gutter-background: var(--code-background);
    --code-gutter-background-dark: #2a2a2a;
    --code-gutter-color: var(--text-color-muted);
    --code-gutter-color-dark: #888888;
    --code-gutter-border-color: var(--border-color-muted);
    --code-gutter-border-color-dark: #404040;
    --code-gutter-border-width: var(--border-width-default);
    --code-gutter-padding: var(--space-0);
    --code-gutter-min-width: 2.5rem;
    --code-gutter-active-line-background: var(--code-cursor-line-background);
    --code-gutter-active-line-background-dark: rgba(255, 255, 255, 0.05);
    --code-gutter-active-line-color: var(--text-color-secondary);
    --code-gutter-active-line-color-dark: #b8b8b8;
    --code-line-numbers: hidden;
    --code-fold-gutter: hidden;

    /* Theme Selection
     *
     * Set --code-theme to use a named theme or 'custom' to apply the CSS variables defined below.
     *
     * Available named themes:
     *
     * Custom: Use CSS variables for full customization
     * Light: basic-light, github-light, gruvbox-light, material-light, solarized-light, tokyo-night-day, vscode-light
     * Dark: abcdef, abyss, android-studio, andromeda, basic-dark, forest, github-dark, gruvbox-dark, material-dark, monokai, nord, palenight, solarized-dark, tokyo-night-storm, volcano, vscode-dark
     *
     * To add more themes, see: web/src/ui/nodes/properties/code/themes/README.md
     */
    --code-theme: basic-light;
    --code-theme-dark: basic-dark;

    /* Syntax Highlighting - Comments */
    --code-comment: var(--color-green-600);
    --code-comment-dark: var(--color-green-500);
    --code-comment-block: var(--code-comment);
    --code-comment-block-dark: var(--code-comment-dark);
    --code-comment-line: var(--code-comment);
    --code-comment-line-dark: var(--code-comment-dark);
    --code-comment-doc: var(--color-green-700);
    --code-comment-doc-dark: var(--color-green-400);

    /* Syntax Highlighting - Keywords */
    --code-keyword: var(--color-blue-700);
    --code-keyword-dark: var(--color-blue-400);
    --code-keyword-control: var(--code-keyword);
    --code-keyword-control-dark: var(--code-keyword-dark);
    --code-keyword-operator: var(--color-gray-600);
    --code-keyword-operator-dark: var(--color-gray-400);
    --code-keyword-modifier: var(--code-keyword);
    --code-keyword-modifier-dark: var(--code-keyword-dark);
    --code-keyword-definition: var(--code-keyword);
    --code-keyword-definition-dark: var(--code-keyword-dark);

    /* Syntax Highlighting - Strings */
    --code-string: var(--color-red-600);
    --code-string-dark: var(--color-red-500);
    --code-string-special: var(--color-red-700);
    --code-string-special-dark: var(--color-red-600);
    --code-string-regex: var(--color-red-600);
    --code-string-regex-dark: var(--color-red-600);
    --code-string-escape: var(--color-red-600);
    --code-string-escape-dark: var(--color-red-600);

    /* Syntax Highlighting - Numbers and Values */
    --code-number: var(--color-green-700);
    --code-number-dark: var(--color-green-300);
    --code-number-integer: var(--code-number);
    --code-number-integer-dark: var(--code-number-dark);
    --code-number-float: var(--code-number);
    --code-number-float-dark: var(--code-number-dark);
    --code-boolean: var(--color-blue-700);
    --code-boolean-dark: var(--color-blue-400);

    /* Syntax Highlighting - Constants */
    --code-constant: var(--color-blue-700);
    --code-constant-dark: var(--color-blue-400);
    --code-constant-builtin: var(--code-constant);
    --code-constant-builtin-dark: var(--code-constant-dark);

    /* Syntax Highlighting - Variables */
    --code-variable: var(--color-blue-600);
    --code-variable-dark: var(--color-blue-300);
    --code-variable-builtin: var(--color-blue-600);
    --code-variable-builtin-dark: var(--color-blue-400);
    --code-variable-special: var(--color-red-700);
    --code-variable-special-dark: var(--color-red-400);

    /* Syntax Highlighting - Functions */
    --code-function: var(--color-amber-700);
    --code-function-dark: var(--color-amber-500);
    --code-function-builtin: var(--color-amber-700);
    --code-function-builtin-dark: var(--color-amber-300);
    --code-function-method: var(--code-function);
    --code-function-method-dark: var(--code-function-dark);

    /* Syntax Highlighting - Classes and Types */
    --code-class: var(--color-amber-700);
    --code-class-dark: var(--color-amber-400);
    --code-class-builtin: var(--code-class);
    --code-class-builtin-dark: var(--code-class-dark);
    --code-type: var(--color-blue-700);
    --code-type-dark: var(--color-blue-300);
    --code-type-builtin: var(--code-type);
    --code-type-builtin-dark: var(--code-type-dark);

    /* Syntax Highlighting - Other */
    --code-namespace: var(--color-gray-600);
    --code-namespace-dark: var(--color-gray-400);
    --code-property: var(--color-blue-600);
    --code-property-dark: var(--color-blue-300);
    --code-attribute: var(--color-amber-600);
    --code-attribute-dark: var(--color-amber-400);
    --code-tag: var(--color-green-600);
    --code-tag-dark: var(--color-green-400);
    --code-tag-angle: var(--color-gray-600);
    --code-tag-angle-dark: var(--color-gray-500);
    --code-operator: var(--color-gray-600);
    --code-operator-dark: var(--color-gray-400);
    --code-punctuation: var(--color-gray-600);
    --code-punctuation-dark: var(--color-gray-500);
    --code-punctuation-bracket: var(--code-punctuation);
    --code-punctuation-bracket-dark: var(--code-punctuation-dark);
    --code-punctuation-delimiter: var(--code-punctuation);
    --code-punctuation-delimiter-dark: var(--code-punctuation-dark);
    --code-meta: var(--color-gray-500);
    --code-meta-dark: var(--color-gray-600);
    --code-invalid: var(--color-red-600);
    --code-invalid-dark: var(--color-red-400);
    --code-invalid-deprecated: var(--color-amber-700);
    --code-invalid-deprecated-dark: var(--color-amber-400);
}

@media (prefers-color-scheme: dark) {
    :root:not([data-color-scheme="light"]) {
        --code-theme: var(--code-theme-dark);
        --code-color: var(--code-color-dark);
        --code-background: var(--code-background-dark);
        --code-background-inline: var(--code-background-inline-dark);
        --code-border-color: var(--code-border-color-dark);
        --code-caret-color: var(--code-caret-color-dark);
        --code-selection-background: var(--code-selection-background-dark);
        --code-selection-match-background: var(--code-selection-match-background-dark);
        --code-cursor-line-background: var(--code-cursor-line-background-dark);
        --code-focused-background: var(--code-focused-background-dark);
        --code-gutter-background: var(--code-gutter-background-dark);
        --code-gutter-color: var(--code-gutter-color-dark);
        --code-gutter-border-color: var(--code-gutter-border-color-dark);
        --code-gutter-active-line-background: var(--code-gutter-active-line-background-dark);
        --code-gutter-active-line-color: var(--code-gutter-active-line-color-dark);

        --code-comment: var(--code-comment-dark);
        --code-comment-block: var(--code-comment-block-dark);
        --code-comment-line: var(--code-comment-line-dark);
        --code-comment-doc: var(--code-comment-doc-dark);
        --code-keyword: var(--code-keyword-dark);
        --code-keyword-control: var(--code-keyword-control-dark);
        --code-keyword-operator: var(--code-keyword-operator-dark);
        --code-keyword-modifier: var(--code-keyword-modifier-dark);
        --code-keyword-definition: var(--code-keyword-definition-dark);
        --code-string: var(--code-string-dark);
        --code-string-special: var(--code-string-special-dark);
        --code-string-regex: var(--code-string-regex-dark);
        --code-string-escape: var(--code-string-escape-dark);
        --code-number: var(--code-number-dark);
        --code-number-integer: var(--code-number-integer-dark);
        --code-number-float: var(--code-number-float-dark);
        --code-boolean: var(--code-boolean-dark);
        --code-constant: var(--code-constant-dark);
        --code-constant-builtin: var(--code-constant-builtin-dark);
        --code-variable: var(--code-variable-dark);
        --code-variable-builtin: var(--code-variable-builtin-dark);
        --code-variable-special: var(--code-variable-special-dark);
        --code-function: var(--code-function-dark);
        --code-function-builtin: var(--code-function-builtin-dark);
        --code-function-method: var(--code-function-method-dark);
        --code-class: var(--code-class-dark);
        --code-class-builtin: var(--code-class-builtin-dark);
        --code-type: var(--code-type-dark);
        --code-type-builtin: var(--code-type-builtin-dark);
        --code-namespace: var(--code-namespace-dark);
        --code-property: var(--code-property-dark);
        --code-attribute: var(--code-attribute-dark);
        --code-tag: var(--code-tag-dark);
        --code-tag-angle: var(--code-tag-angle-dark);
        --code-operator: var(--code-operator-dark);
        --code-punctuation: var(--code-punctuation-dark);
        --code-punctuation-bracket: var(--code-punctuation-bracket-dark);
        --code-punctuation-delimiter: var(--code-punctuation-delimiter-dark);
        --code-meta: var(--code-meta-dark);
        --code-invalid: var(--code-invalid-dark);
        --code-invalid-deprecated: var(--code-invalid-deprecated-dark);
    }
}

:root[data-color-scheme="dark"] {
    --code-theme: var(--code-theme-dark);
    --code-color: var(--code-color-dark);
    --code-background: var(--code-background-dark);
    --code-background-inline: var(--code-background-inline-dark);
    --code-border-color: var(--code-border-color-dark);
    --code-caret-color: var(--code-caret-color-dark);
    --code-selection-background: var(--code-selection-background-dark);
    --code-selection-match-background: var(--code-selection-match-background-dark);
    --code-cursor-line-background: var(--code-cursor-line-background-dark);
    --code-focused-background: var(--code-focused-background-dark);
    --code-gutter-background: var(--code-gutter-background-dark);
    --code-gutter-color: var(--code-gutter-color-dark);
    --code-gutter-border-color: var(--code-gutter-border-color-dark);
    --code-gutter-active-line-background: var(--code-gutter-active-line-background-dark);
    --code-gutter-active-line-color: var(--code-gutter-active-line-color-dark);

    --code-comment: var(--code-comment-dark);
    --code-comment-block: var(--code-comment-block-dark);
    --code-comment-line: var(--code-comment-line-dark);
    --code-comment-doc: var(--code-comment-doc-dark);
    --code-keyword: var(--code-keyword-dark);
    --code-keyword-control: var(--code-keyword-control-dark);
    --code-keyword-operator: var(--code-keyword-operator-dark);
    --code-keyword-modifier: var(--code-keyword-modifier-dark);
    --code-keyword-definition: var(--code-keyword-definition-dark);
    --code-string: var(--code-string-dark);
    --code-string-special: var(--code-string-special-dark);
    --code-string-regex: var(--code-string-regex-dark);
    --code-string-escape: var(--code-string-escape-dark);
    --code-number: var(--code-number-dark);
    --code-number-integer: var(--code-number-integer-dark);
    --code-number-float: var(--code-number-float-dark);
    --code-boolean: var(--code-boolean-dark);
    --code-constant: var(--code-constant-dark);
    --code-constant-builtin: var(--code-constant-builtin-dark);
    --code-variable: var(--code-variable-dark);
    --code-variable-builtin: var(--code-variable-builtin-dark);
    --code-variable-special: var(--code-variable-special-dark);
    --code-function: var(--code-function-dark);
    --code-function-builtin: var(--code-function-builtin-dark);
    --code-function-method: var(--code-function-method-dark);
    --code-class: var(--code-class-dark);
    --code-class-builtin: var(--code-class-builtin-dark);
    --code-type: var(--code-type-dark);
    --code-type-builtin: var(--code-type-builtin-dark);
    --code-namespace: var(--code-namespace-dark);
    --code-property: var(--code-property-dark);
    --code-attribute: var(--code-attribute-dark);
    --code-tag: var(--code-tag-dark);
    --code-tag-angle: var(--code-tag-angle-dark);
    --code-operator: var(--code-operator-dark);
    --code-punctuation: var(--code-punctuation-dark);
    --code-punctuation-bracket: var(--code-punctuation-bracket-dark);
    --code-punctuation-delimiter: var(--code-punctuation-delimiter-dark);
    --code-meta: var(--code-meta-dark);
    --code-invalid: var(--code-invalid-dark);
    --code-invalid-deprecated: var(--code-invalid-deprecated-dark);
}

stencila-code-inline {
    code {
        font-family: var(--code-font-family);
        font-size: var(--code-font-size-inline);
        line-height: var(--code-line-height);
        color: var(--code-color);
        background: var(--code-background-inline);
        padding: var(--code-padding-inline);
        border-radius: var(--code-border-radius);

        /* Prevents background/border overlap when wrapping across lines.
         * Creates separate boxes for each line fragment. */
        box-decoration-break: clone;
        -webkit-box-decoration-break: clone;
    }
}

stencila-code-block {
    display: block;

    /* Spacing */
    margin-top: var(--code-spacing);

    pre {
        /* Browser normalization */
        margin: 0;
        overflow-x: auto;
        max-width: 100%;
        word-break: break-all;
        white-space: pre-wrap;

        code {
            display: block;

            font-family: var(--code-font-family);
            font-size: var(--code-font-size-block);
            line-height: var(--code-line-height);
            color: var(--code-color);
            background-color: var(--code-background-block);
            border: var(--code-border-width) solid var(--code-border-color);
            border-radius: var(--code-border-radius);
            padding: var(--code-padding-block);
        }
    }
}