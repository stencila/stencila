/* Heading styles
 *
 * Schema: [Heading](../../schema/Heading.yaml)
 * Purpose: Document headings with hierarchical levels (h1-h6).
 *
 * DOM Structure:
 * <stencila-heading id=xxx depth=N ancestors=Parent level=1>
 *     <h1 slot=content>
 *         <stencila-text id=xxx depth=N+1 ancestors=Parent.Heading>Heading text</stencila-text>
 *     </h1>
 * </stencila-heading>
 *
 * Key Attributes:
 * - level: Heading level (1-6) determining which HTML heading element is used
 *
 * Slots:
 * - content: Contains the HTML heading element (h1-h6) with text content
 *
 * Notes:
 * - Heading levels automatically map to appropriate HTML elements (h1-h6)
 *
 * Examples: examples/conversion/heading/heading.dom.html
 */

:root {
    --heading-spacing-top: calc(var(--content-spacing) * 1.5);
    --heading-spacing-bottom: calc(var(--content-spacing) * 0.5);
    --heading-spacing-ratio: 0.8;
    --heading-spacing-adjacent-ratio: 0.5;

    /* Pre-calculated spacing for each level - used for normal and adjacent heading spacing */
    --heading-spacing-top-1: var(--heading-spacing-top);
    --heading-spacing-top-2: calc(var(--heading-spacing-top) * var(--heading-spacing-ratio));
    --heading-spacing-top-3: calc(var(--heading-spacing-top) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
    --heading-spacing-top-4: calc(var(--heading-spacing-top) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
    --heading-spacing-top-5: calc(var(--heading-spacing-top) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
    --heading-spacing-top-6: calc(var(--heading-spacing-top) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));

    --heading-font-family: var(--font-family-serif);

    /* Heading size system: base size for h1, ratio for subsequent levels
     * Each level = previous level × ratio
     * With 2.0× base and 0.85 ratio: h1=2.0×, h2=1.7×, h3=1.45×, h4=1.23×, h5=1.05×, h6=0.89×
     * Ensures all headings remain at or near body text size for better hierarchy */
    --heading-font-size: calc(var(--text-font-size) * 2.0);
    --heading-font-size-print: calc(var(--text-font-size-print) * 1.75);
    --heading-font-size-ratio: 0.85;

    --heading-font-weight: var(--font-weight-bold);
    --heading-font-weight-decrement: 50;

    --heading-line-height: var(--line-height-tight);
    --heading-letter-spacing: -0.025em;

    --heading-color: var(--text-color-primary);
    --heading-color-dark: var(--text-color-primary);
    --heading-color-opacity-decrement: 0;
}

/* Spacing applied at outer element level based on heading level */
stencila-heading[level="1"] {
    margin-top: var(--heading-spacing-top-1);
}

stencila-heading[level="2"] {
    margin-top: var(--heading-spacing-top-2);
}

stencila-heading[level="3"] {
    margin-top: var(--heading-spacing-top-3);
}

stencila-heading[level="4"] {
    margin-top: var(--heading-spacing-top-4);
}

stencila-heading[level="5"] {
    margin-top: var(--heading-spacing-top-5);
}

stencila-heading[level="6"] {
    margin-top: var(--heading-spacing-top-6);
}

/* Reduced spacing for adjacent headings - avoids awkward gaps when headings follow each other */
stencila-heading+stencila-heading[level="2"] {
    margin-top: calc(var(--heading-spacing-top-2) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-heading[level="3"] {
    margin-top: calc(var(--heading-spacing-top-3) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-heading[level="4"] {
    margin-top: calc(var(--heading-spacing-top-4) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-heading[level="5"] {
    margin-top: calc(var(--heading-spacing-top-5) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-heading[level="6"] {
    margin-top: calc(var(--heading-spacing-top-6) * var(--heading-spacing-adjacent-ratio));
}

/* Reduced spacing when heading is followed by section (section's first child is typically a heading) */
stencila-heading+stencila-section>section>stencila-heading[level="2"]:first-child {
    margin-top: calc(var(--heading-spacing-top-2) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-section>section>stencila-heading[level="3"]:first-child {
    margin-top: calc(var(--heading-spacing-top-3) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-section>section>stencila-heading[level="4"]:first-child {
    margin-top: calc(var(--heading-spacing-top-4) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-section>section>stencila-heading[level="5"]:first-child {
    margin-top: calc(var(--heading-spacing-top-5) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading+stencila-section>section>stencila-heading[level="6"]:first-child {
    margin-top: calc(var(--heading-spacing-top-6) * var(--heading-spacing-adjacent-ratio));
}

stencila-heading {
    display: block;

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        /* Browser normalization */
        margin-top: 0;
        overflow-wrap: break-word;

        font-family: var(--heading-font-family);
        line-height: var(--heading-line-height);
        letter-spacing: var(--heading-letter-spacing);
        color: var(--heading-color);
        margin-bottom: var(--heading-spacing-bottom);
    }

    h1 {
        font-size: var(--heading-font-size);
        font-weight: var(--heading-font-weight);
    }

    h2 {
        font-size: calc(var(--heading-font-size) * var(--heading-font-size-ratio));
        font-weight: calc(var(--heading-font-weight) - var(--heading-font-weight-decrement));
        margin-bottom: calc(var(--heading-spacing-bottom) * var(--heading-spacing-ratio));
        opacity: calc(1 - var(--heading-color-opacity-decrement) * 1);
    }

    h3 {
        font-size: calc(var(--heading-font-size) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio));
        font-weight: calc(var(--heading-font-weight) - var(--heading-font-weight-decrement) * 2);
        margin-bottom: calc(var(--heading-spacing-bottom) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
        opacity: calc(1 - var(--heading-color-opacity-decrement) * 2);
    }

    h4 {
        font-size: calc(var(--heading-font-size) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio));
        font-weight: calc(var(--heading-font-weight) - var(--heading-font-weight-decrement) * 3);
        margin-bottom: calc(var(--heading-spacing-bottom) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
        opacity: calc(1 - var(--heading-color-opacity-decrement) * 3);
    }

    h5 {
        font-size: calc(var(--heading-font-size) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio));
        font-weight: calc(var(--heading-font-weight) - var(--heading-font-weight-decrement) * 4);
        margin-bottom: calc(var(--heading-spacing-bottom) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
        opacity: calc(1 - var(--heading-color-opacity-decrement) * 4);
    }

    h6 {
        font-size: calc(var(--heading-font-size) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio) * var(--heading-font-size-ratio));
        font-weight: calc(var(--heading-font-weight) - var(--heading-font-weight-decrement) * 5);
        margin-bottom: calc(var(--heading-spacing-bottom) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio) * var(--heading-spacing-ratio));
        opacity: calc(1 - var(--heading-color-opacity-decrement) * 5);
    }
}

/* Dark Mode Application - System Preference */
@media (prefers-color-scheme: dark) {
    :root:not([data-color-scheme="light"]) {
        --heading-color: var(--heading-color-dark);
    }
}

/* Dark Mode Application - Explicit User Choice */
:root[data-color-scheme="dark"] {
    --heading-color: var(--heading-color-dark);
}

/* Mobile breakpoint (640px) - Special case for h1 top margin
 * Override from automatic 1.5rem (calc(1rem * 1.5)) to 1rem for better mobile spacing
 * This deviation from automatic scaling is needed because h1's large size creates too much
 * visual weight and negative space on mobile screens. The fixed 1rem provides better
 * visual balance while maintaining content rhythm. */
@media (max-width: 640px) {
    stencila-heading[level="1"] {
        margin-top: var(--space-4);
    }
}

/* Print Application */
@media print {
    :root {
        --heading-font-size: var(--heading-font-size-print);
    }

    stencila-heading {
        /* Avoid headings from being orphaned at the bottom of pages */
        page-break-after: avoid;
        break-after: avoid-page;
    }

    stencila-heading h1,
    stencila-heading h2,
    stencila-heading h3,
    stencila-heading h4,
    stencila-heading h5,
    stencila-heading h6 {
        /* Additional specificity for the actual h1-h6 elements */
        page-break-after: avoid;
        break-after: avoid-page;
    }
    
    stencila-heading + stencila-paragraph {
        /* Avoid paragraphs from being orphaned at the top of pages */
        page-break-before: avoid;
        break-before: avoid-page;
    }
}