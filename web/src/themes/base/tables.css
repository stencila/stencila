/* Table styles
 *
 * Schema: [`Table`](../../schema/Table.yaml)
 * Purpose: Structured data presentation in rows and columns with optional captions and notes.
 *
 * DOM Structure:
 * <stencila-table id=xxx depth=N ancestors=Parent label=X label-automatically=false>
 *     <table slot=rows>
 *         <caption>
 *             <stencila-paragraph id=xxx depth=N+1 ancestors=Parent.Table>
 *                 <p slot=content>
 *                     <span class=table-label>Table X</span>: <stencila-text id=xxx depth=N+2 ancestors=Parent.Table.Paragraph>Caption text.</stencila-text>
 *                 </p>
 *             </stencila-paragraph>
 *         </caption>
 *         <thead>
 *             <tr id=xxx depth=N+1 ancestors=Parent.Table>
 *                 <th id=xxx depth=N+2 ancestors=Parent.Table.TableRow>
 *                     <stencila-text id=xxx depth=N+3 ancestors=Parent.Table.TableRow.TableCell>Header</stencila-text>
 *                 </th>
 *             </tr>
 *         </thead>
 *         <tbody>
 *             <tr id=xxx depth=N+1 ancestors=Parent.Table>
 *                 <td id=xxx depth=N+2 ancestors=Parent.Table.TableRow>
 *                     <stencila-text id=xxx depth=N+3 ancestors=Parent.Table.TableRow.TableCell>Cell content</stencila-text>
 *                 </td>
 *             </tr>
 *         </tbody>
 *     </table>
 *     <aside slot=notes>
 *         <stencila-paragraph id=xxx depth=N+1 ancestors=Parent.Table>
 *             <p slot=content>
 *                 <stencila-text id=xxx depth=N+2 ancestors=Parent.Table.Paragraph>Notes text.</stencila-text>
 *             </p>
 *         </stencila-paragraph>
 *     </aside>
 * </stencila-table>
 *
 * Key Attributes:
 * - label: Table number (e.g., "3")
 * - label-automatically: Boolean indicating if label was auto-generated
 *
 * Slots:
 * - caption: Optional caption with table label and descriptive text
 * - rows: Contains the HTML table element with all rows and cells
 * - notes: Optional aside with additional notes or annotations
 *
 * Notes:
 * - Tables use semantic HTML table elements (table, caption, thead, tbody, tr, th, td)
 * - Each cell contains Stencila text or other inline content
 * - Supports both simple data tables and complex structured content
 * - Caption includes a table label styled with --table-label-* tokens
 * - Labels can be automatically generated or manually specified
 * - Headers use th elements within thead, data cells use td elements
 *
 * Examples: examples/conversion/table/table.dom.html
 * Documentation: docs/themes/tables.smd
 */

:root {
    /* Table layout - positioning and constraints (matches figure pattern) */
    --table-min-width: 100%;
    --table-max-width: 100%;
    --table-margin-horizontal: auto;

    /* Vertical spacing tokens - vertical separation from surrounding content */
    --table-spacing-top: var(--content-spacing);
    --table-spacing-bottom: var(--content-spacing);

    /* Caption typography - inherits from caption tokens */
    --table-caption-font-family: var(--caption-font-family);
    --table-caption-font-size: var(--caption-font-size);
    --table-caption-color: var(--caption-color);
    --table-caption-spacing-bottom: var(--caption-spacing);
    --table-caption-line-height: var(--caption-line-height);
    --table-caption-align: var(--caption-align);
    --table-caption-max-width: var(--caption-max-width);

    /* Label styling - inherits from semantic label tokens */
    --table-label-font-weight: var(--label-font-weight);
    --table-label-font-style: var(--label-font-style);
    --table-label-color: var(--label-color);

    /* Notes typography - independent from caption tokens */
    --table-notes-font-family: var(--text-font-family);
    --table-notes-font-size: calc(var(--text-font-size) * 0.80);
    --table-notes-color: var(--text-color-secondary);
    --table-notes-spacing-top: calc(var(--content-spacing) * 0.5);
    --table-notes-line-height: var(--line-height-normal);
    --table-notes-align: left;

    /* Table borders - granular control for theme authors */
    --table-border-radius: var(--border-radius-default);

    /* Outer border - base tokens */
    --table-border-width: var(--border-width-default);
    --table-border-width-print: 0;
    --table-border-color: var(--border-color-default);
    --table-border-style: solid;

    /* Outer border - individual edges (for granular control) */
    --table-border-top-width: var(--table-border-width);
    --table-border-top-width-print: var(--table-border-width-print);
    --table-border-top-color: var(--table-border-color);
    --table-border-top-style: var(--table-border-style);

    --table-border-bottom-width: var(--table-border-width);
    --table-border-bottom-width-print: var(--table-border-width-print);
    --table-border-bottom-color: var(--table-border-color);
    --table-border-bottom-style: var(--table-border-style);

    --table-border-left-width: var(--table-border-width);
    --table-border-left-width-print: var(--table-border-width-print);
    --table-border-left-color: var(--table-border-color);
    --table-border-left-style: var(--table-border-style);

    --table-border-right-width: var(--table-border-width);
    --table-border-right-width-print: var(--table-border-width-print);
    --table-border-right-color: var(--table-border-color);
    --table-border-right-style: var(--table-border-style);

    /* Row borders - base tokens */
    --table-row-border-width: var(--border-width-default);
    --table-row-border-width-print: var(--border-width-default);
    --table-row-border-color: var(--border-color-default);
    --table-row-border-style: solid;

    /* Header separator (below thead) */
    --table-header-border-bottom-width: var(--table-row-border-width);
    --table-header-border-bottom-width-print: var(--table-row-border-width-print);
    --table-header-border-bottom-color: var(--table-row-border-color);
    --table-header-border-bottom-style: var(--table-row-border-style);

    /* Body row separators */
    --table-body-row-border-width: var(--table-row-border-width);
    --table-body-row-border-width-print: var(--table-row-border-width-print);
    --table-body-row-border-color: var(--table-row-border-color);
    --table-body-row-border-style: var(--table-row-border-style);

    /* Column borders */
    --table-column-border-width: 0;
    --table-column-border-width-print: 0;
    --table-column-border-color: var(--border-color-default);
    --table-column-border-style: solid;

    /* Header styling */
    --table-header-background: var(--surface-sunken);
    --table-header-background-dark: var(--surface-sunken-dark);
    --table-header-background-print: transparent;
    --table-header-font-weight: var(--font-weight-semibold);

    /* Row styling with dark and print variants */
    --table-row-hover: var(--color-gray-50);
    --table-row-hover-dark: #303030;
    --table-row-striped: transparent;
    --table-row-striped-dark: transparent;
    --table-row-striped-print: transparent;

    /* Cell styling */
    --table-cell-font-family: var(--text-font-family);
    --table-cell-font-size: calc(var(--text-font-size) * 0.85);
    --table-cell-line-height: var(--line-height-normal);
    --table-cell-line-height-mobile: var(--line-height-tight);
    --table-cell-line-height-print: var(--line-height-tight);
    --table-cell-padding: var(--space-2);
    --table-cell-padding-mobile: var(--space-1);
    --table-cell-padding-print: var(--space-xs);
}

/* Dark Mode Application - System Preference */
@media (prefers-color-scheme: dark) {
    :root:not([data-color-scheme="light"]) {
        --table-header-background: var(--table-header-background-dark);
        --table-row-hover: var(--table-row-hover-dark);
        --table-row-striped: var(--table-row-striped-dark);
    }
}

/* Dark Mode Application - Explicit User Choice */
:root[data-color-scheme="dark"] {
    --table-header-background: var(--table-header-background-dark);
    --table-row-hover: var(--table-row-hover-dark);
    --table-row-striped: var(--table-row-striped-dark);
}

/* Responsive Application - Mobile Breakpoint (640px) */
@media (max-width: 640px) {
    :root {
        --table-cell-line-height: var(--table-cell-line-height-mobile);
        --table-cell-padding: var(--table-cell-padding-mobile);
    }
}

stencila-table {
    display: block;

    /* Enable horizontal scrolling for wide tables */
    overflow-x: auto;

    /* Vertical spacing */
    margin-top: var(--table-spacing-top);
    margin-bottom: var(--table-spacing-bottom);

    /* Table element styling */
    table {
        min-width: var(--table-min-width);
        max-width: var(--table-max-width);
        margin-left: var(--table-margin-horizontal);
        margin-right: var(--table-margin-horizontal);
        border-collapse: collapse;
        border-top: var(--table-border-top-width) var(--table-border-top-style) var(--table-border-top-color);
        border-bottom: var(--table-border-bottom-width) var(--table-border-bottom-style) var(--table-border-bottom-color);
        border-left: var(--table-border-left-width) var(--table-border-left-style) var(--table-border-left-color);
        border-right: var(--table-border-right-width) var(--table-border-right-style) var(--table-border-right-color);
        border-radius: var(--table-border-radius);
    }

    /* Caption styling */
    caption {
        margin-bottom: var(--table-caption-spacing-bottom);
        max-width: var(--table-caption-max-width);

        stencila-paragraph p {
            /* Browser normalization */
            max-width: none;
            margin: 0;

            /* Caption typography - inherits from component tokens */
            font-family: var(--table-caption-font-family);
            font-size: var(--table-caption-font-size);
            color: var(--table-caption-color);
            line-height: var(--table-caption-line-height);
            text-align: var(--table-caption-align);
        }

        /* Paragraph spacing: first paragraph aligns with caption,
         * subsequent paragraphs use caption spacing to maintain visual hierarchy */
        stencila-paragraph:first-child {
            margin-top: 0;
        }

        stencila-paragraph:not(:first-child) {
            margin-top: var(--table-caption-spacing-bottom);
        }

        /* Label styling within caption */
        .table-label {
            font-weight: var(--table-label-font-weight);
            font-style: var(--table-label-font-style);
            color: var(--table-label-color);
        }
    }

    /* Header styling */
    th {
        background-color: var(--table-header-background);

        padding: var(--table-cell-padding);
        text-align: left;
        border-bottom: var(--table-header-border-bottom-width) var(--table-header-border-bottom-style) var(--table-header-border-bottom-color);

        font-family: var(--table-cell-font-family);
        font-weight: var(--table-header-font-weight);
        font-size: var(--table-cell-font-size);
        line-height: var(--table-cell-line-height);
    }

    th:not(:first-child) {
        border-left: var(--table-column-border-width) var(--table-column-border-style) var(--table-column-border-color);
    }

    /* Cell styling */
    td {
        padding: var(--table-cell-padding);
        text-align: left;
        border-bottom: var(--table-body-row-border-width) var(--table-body-row-border-style) var(--table-body-row-border-color);

        font-family: var(--table-cell-font-family);
        font-size: var(--table-cell-font-size);
        line-height: var(--table-cell-line-height);
    }

    td:not(:first-child) {
        border-left: var(--table-column-border-width) var(--table-column-border-style) var(--table-column-border-color);
    }

    /* Row hover effect */
    tbody tr:hover {
        background-color: var(--table-row-hover);
    }

    /* Striped rows */
    tbody tr:nth-child(even) {
        background-color: var(--table-row-striped);
    }

    /* Notes styling */
    [slot='notes'] {
        margin-top: var(--table-notes-spacing-top);

        stencila-paragraph p {
            font-family: var(--table-notes-font-family);
            font-size: var(--table-notes-font-size);
            color: var(--table-notes-color);
            line-height: var(--table-notes-line-height);
            text-align: var(--table-notes-align);
        }

        /* Paragraph spacing within notes */
        stencila-paragraph:first-child {
            margin-top: 0;
        }

        stencila-paragraph:not(:first-child) {
            margin-top: var(--table-notes-spacing-top);
        }
    }
}

/* Print Media Optimization */
@media print {
    :root {
        /* Base border tokens */
        --table-border-width: var(--table-border-width-print);
        --table-row-border-width: var(--table-row-border-width-print);
        --table-column-border-width: var(--table-column-border-width-print);

        /* Individual edge tokens */
        --table-border-top-width: var(--table-border-top-width-print);
        --table-border-bottom-width: var(--table-border-bottom-width-print);
        --table-border-left-width: var(--table-border-left-width-print);
        --table-border-right-width: var(--table-border-right-width-print);

        /* Header and body border tokens */
        --table-header-border-bottom-width: var(--table-header-border-bottom-width-print);
        --table-body-row-border-width: var(--table-body-row-border-width-print);

        /* Other print optimizations */
        --table-header-background: var(--table-header-background-print);
        --table-row-striped: var(--table-row-striped-print);
        --table-cell-line-height: var(--table-cell-line-height-print);
        --table-cell-padding: var(--table-cell-padding-print);
    }

    stencila-table {
        /* Prevent table (including caption, rows, and notes) from breaking across pages */
        page-break-inside: avoid;
        break-inside: avoid;
    }
}
