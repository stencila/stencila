/*

 Applies the default styles to all stencila Node custom web elements

*/

/* headings */

stencila-heading {
  display: block;
  border: 1px solid transparent;

  + stencila-paragraph {
    p {
      margin-top: 0;
    }
  }
}

stencila-heading {
  display: block;
  border: 1px solid transparent;

  + stencila-paragraph {
    p {
      margin-top: 0;
    }
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-weight: 500;
    @apply w-full;
  }

  h1 {
    margin-top: 3rem;
    line-height: 1.1;
    @apply mb-4 text-3xl lg:text-4xl;
  }

  h2 {
    margin-top: 2rem;
    line-height: 1.1;
    @apply text-2xl lg:text-3xl;
  }

  h3 {
    margin-top: 1.5rem;
  }

  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply mb-1.5 w-full;
  }
}

/* ------------ */

/* paragraph */

stencila-paragraph {
  p {
    @apply mt-4 mb-0 pr-0 align-baseline leading-snug;
  }

  display: block;
  border: 1px solid transparent;

  &:has(+ stencila-heading) {
    p {
      margin-bottom: 0;
    }
  }
}

/* table, datatable and figure */

stencila-table,
stencila-datatable {
  table {
    @apply my-4 border-collapse border-spacing-0 table-auto;

    tr:first-child,
    thead {
      stencila-text {
        font-weight: bold !important;
      }

      th {
        @apply pb-3;
        border-bottom: 1px solid rgba(0, 0, 0, 0.3);
      }
    }

    td,
    th {
      @apply p-0 w-fit pr-3 text-nowrap;
    }

    td[data-type='number'],
    td[data-type='integer'] {
      text-align: right;
    }

    p {
      @apply m-0;
    }

    stencila-paragraph {
      display: contents;
    }

    stencila-paragraph *,
    stencila-ui-block-on-demand,
    stencila-ui-block-on-demand * {
      max-width: fit-content;
    }

    div:not(.chip) {
      display: contents;
    }
  }
}

/* Give vertical margin to tables, figures and code chunks */
stencila-table:not([root]),
stencila-figure:not([root]),
stencila-code-chunk:not([root]) {
  @apply block my-12;
}

/* Give vertical margin to supplements - less than for tables & figures because
supplements are usually collapsed (so too much margin creates too much
whitespace) and they usually contain tables and figures etc that already have
vertical margin*/
stencila-supplement:not([root]) {
  @apply block my-3;
}

stencila-table,
stencila-figure,
stencila-code-chunk,
stencila-supplement {
  /* Remove browser's horizontal margin on <figure> element so that they can
  occupy parent width 100% */
  figure {
    @apply m-0;
  }

  [slot='caption'] {
    @apply block;

    stencila-paragraph {
      p {
        @apply mt-4 text-sm text-black text-left;
      }

      .table-label,
      .figure-label,
      .supplement-label {
        @apply font-bold;
      }
    }
  }

  /*
  TODO: The following break Paged.js polyfill. Evaluate if they are necessary.

  &[label-type='FigureLabel'] {
    [slot='caption'] {
      @apply mb-4;

      stencila-paragraph:first-child {
        p {
          @apply mt-0;
        }
      }
    }
  }

  [slot='caption'] + [slot='outputs'] {
    @apply mt-0;
  }
  */
}

stencila-figure,
stencila-code-chunk,
stencila-supplement {
  /* Restrict width of media within figures etc to 100% of parent. This is
  applied below in rule for stencila-image-object etc but this ensures this
  restriction if, for example, a figure has a paragraph with an inline image,
  rather than a block image. */
  img,
  audio,
  video {
    @apply block max-w-full mx-auto;
  }
}

/* Media objects */

/* Give vertical margin to media objects that are not in figures, tables, math,
(they have their own margin; yes tables can have images in them) or are inline
within paragraphs or headings */
stencila-audio-object:not([root]),
stencila-image-object:not([root]),
stencila-video-object:not([root]) {
  &:not(stencila-figure *, stencila-table *, stencila-math-block *,
       stencila-paragraph *, stencila-heading *) {
    @apply block my-12;
  }
}

stencila-audio-object,
stencila-image-object,
stencila-video-object {
  /* Restrict width of block media (not in paragraph or heading) to 100% of
  parent. Note that this applies to the media element in the light DOM and web
  components may create their own media elements in the shadow DOM where
  necessary (e.g. when url needs to be re-written */
  img,
  audio,
  video {
    &:not(stencila-paragraph *, stencila-heading *) {
      @apply block max-w-full mx-auto;
    }
  }

  /* Style caption (note this will apply to images etc within figures and so it
  intentionally smaller than the figure caption text and centered below the
  image. */
  [slot='caption'] {
    @apply block text-center text-xs;
  }
}

/* Math */

/* Give vertical margin to math blocks */
stencila-math-block:not([root]) {
  @apply block my-4;
}

/* Apply math font to MathML */
stencila-math-block,
stencila-math-inline {
  [slot='mathml'] {
    math {
      font-family: var(--mathml-font-family);
    }
  }
}

/* admonitions  */

stencila-admonition {
  p[slot='title'] {
    @apply my-0;
  }

  [slot='content'] {
    stencila-paragraph:first-child {
      p {
        @apply mt-0;
      }
    }
  }
}

/* quote blocks */

stencila-quote-block {
  blockquote {
    @apply border-solid border-y-0 border-l-2 border-r-0 border-black/20 bg-black/5 py-4 pl-3 m-6;

    p {
      @apply m-0 pb-0;
    }

    blockquote {
      @apply m-0 mt-2 ml-3 border-black/20;
    }
  }
}

/* lists */

stencila-list {
  ul,
  ol {
    padding-left: 2rem;
  }

  ul {
    list-style: disc;
  }

  ol {
    list-style-type: decimal;
  }
}

stencila-list-item {
  stencila-paragraph {
    margin: 0;
    p {
      margin: 0;
    }
  }
}

/* ------------ */

/* code elements */

stencila-ui-node-code {
  max-width: 100%;
}

stencila-code-chunk {
  [slot='outputs'] {
    stencila-boolean,
    stencila-integer,
    stencila-number,
    stencila-string,
    stencila-array,
    stencila-object {
      @apply block font-mono;
    }
  }

  + stencila-paragraph {
    p {
      @apply mt-0;
    }
  }
}

stencila-code-expression,
stencila-code-inline {
  code {
    font-family: var(--code-font-family);
    font-size: var(--code-font-size);
    background-color: var(--code-bg-colour);
    @apply rounded-sm font-normal px-0.5;
  }
}

/* ------------ */

/* Ai model instruction related elements */

stencila-instruction-block {
  &:has(+ stencila-heading) {
    ol {
      @apply mb-0;
    }
  }

  &:has(+ stencila-paragraph) {
    table {
      @apply mb-0;
    }
  }

  [slot='messages'] {
    @apply hidden;
  }
}

stencila-chat-message[message-role='User'] {
  [slot='content'] {
    stencila-paragraph:first-child {
      p {
        @apply mt-0;
      }
    }
  }
}

stencila-suggestion-block {
  [slot='content'] {
    color: var(--default-text-colour);
  }
}

/* ------------ */
