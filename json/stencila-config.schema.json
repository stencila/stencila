{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stencila Config",
  "description": "Configuration for Stencila workspaces",
  "type": "object",
  "properties": {
    "remotes": {
      "description": "Remote synchronization configuration\n\nMaps local paths to remote service URLs. The key is the local path\n(file, directory, or pattern), and the value can be:\n- A simple URL string: `\"site\" = \"https://example.stencila.site/\"`\n- An object with watch: `\"file.md\" = { url = \"...\", watch = \"w123\" }`\n- Multiple remotes: `\"file.md\" = [{ url = \"...\", watch = \"...\" }, \"https://...\"]`\n\nDirectory paths are implicitly recursive, matching all files within.\n\nExample:\n```toml\n[remotes]\n\"site\" = \"https://example.stencila.site/\"\n\"docs/report.md\" = { url = \"https://docs.google.com/...\", watch = \"w123\" }\n\"article.md\" = [\n  { url = \"https://docs.google.com/...\", watch = \"w456\" },\n  \"https://sharepoint.com/...\"\n]\n```",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": {
        "$ref": "#/definitions/RemoteValue"
      }
    },
    "site": {
      "description": "Site configuration",
      "anyOf": [
        {
          "$ref": "#/definitions/SiteConfig"
        },
        {
          "type": "null"
        }
      ]
    },
    "routes": {
      "description": "Custom routes for serving content\n\nRoutes map URL paths to files or redirects. The key is the URL path,\nand the value can be either:\n- A simple string for the file path: `\"/about/\" = \"README.md\"`\n- An object for redirects: `\"/old/\" = { redirect = \"/new/\", status = 301 }`\n\nRoutes can be used by both remote sites (e.g., stencila.site) and\nlocal development servers.\n\nExample:\n```toml\n[routes]\n\"/\" = \"index.md\"\n\"/about/\" = \"README.md\"\n\"/old-page/\" = { redirect = \"/new-page/\", status = 301 }\n\"/external/\" = { redirect = \"https://example.com\" }\n```",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": {
        "$ref": "#/definitions/RouteTarget"
      }
    }
  },
  "definitions": {
    "RemoteValue": {
      "description": "Value for a remote configuration entry - can be single or multiple targets\n\nSupports both simple cases (one URL) and complex cases (multiple URLs per path).\nEach target can be a simple URL string or an object with a watch ID.",
      "anyOf": [
        {
          "description": "Single remote target\n\nExample in TOML:\n```toml\n[remotes]\n\"site\" = \"https://example.stencila.site/\"\n\"file.md\" = { url = \"https://...\", watch = \"w123\" }\n```",
          "allOf": [
            {
              "$ref": "#/definitions/RemoteTarget"
            }
          ]
        },
        {
          "description": "Multiple remote targets for the same path\n\nExample in TOML:\n```toml\n[remotes]\n\"article.md\" = [\n  { url = \"https://docs.google.com/...\", watch = \"w456\" },\n  \"https://sharepoint.com/...\"\n]\n```",
          "type": "array",
          "items": {
            "$ref": "#/definitions/RemoteTarget"
          }
        }
      ]
    },
    "RemoteTarget": {
      "description": "A remote synchronization target - either a URL or URL with watch info\n\nCan be either a simple URL string (for remotes without watch IDs)\nor an object containing URL and watch ID.",
      "anyOf": [
        {
          "description": "Simple URL string (no watch)\n\nExample: `\"https://example.stencila.site/\"`",
          "type": "string",
          "format": "uri"
        },
        {
          "description": "URL with watch information\n\nExample: `{ url = \"https://...\", watch = \"w123\" }`",
          "allOf": [
            {
              "$ref": "#/definitions/RemoteInfo"
            }
          ]
        }
      ]
    },
    "RemoteInfo": {
      "description": "Remote synchronization information with watch ID",
      "type": "object",
      "properties": {
        "url": {
          "description": "Remote URL\n\nThe service type is inferred from the URL host:\n- Google Docs: https://docs.google.com/document/d/...\n- Microsoft 365: https://*.sharepoint.com/...\n- Stencila Sites: https://*.stencila.site/...",
          "type": "string",
          "pattern": "^https?://"
        },
        "watch": {
          "description": "Watch ID from Stencila Cloud\n\nIf this remote is being watched for automatic synchronization, this\nfield contains the watch ID. Watch configuration (direction, PR mode,\ndebounce) is stored in Stencila Cloud and queried via the API.",
          "type": [
            "string",
            "null"
          ],
          "pattern": "^w[a-zA-Z0-9]{9}$"
        }
      },
      "required": [
        "url"
      ]
    },
    "SiteConfig": {
      "description": "Configuration for a site",
      "type": "object",
      "properties": {
        "id": {
          "description": "The id of the Stencila Site\n\nReturned by Stencila Cloud when a site is created.",
          "type": [
            "string",
            "null"
          ],
          "pattern": "^s[a-z0-9]{9}$"
        },
        "domain": {
          "description": "Custom domain for the site\n\nThis is a cached value that is kept in sync with Stencila Cloud\nwhen site details are fetched or the domain is modified.\nThe canonical source is the Stencila Cloud API.",
          "type": [
            "string",
            "null"
          ],
          "pattern": "^([a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z]{2,}$"
        },
        "root": {
          "description": "Root directory for site content\n\nPath relative to the config file containing this setting.\nWhen set, only files within this directory will be published\nto the site, and routes will be calculated relative to this\ndirectory rather than the workspace root.\n\nExample: If set to \"docs\" in /myproject/stencila.toml,\nthen /myproject/docs/guide.md â†’ /guide/ (not /docs/guide/)",
          "anyOf": [
            {
              "$ref": "#/definitions/ConfigRelativePath"
            },
            {
              "type": "null"
            }
          ]
        },
        "exclude": {
          "description": "Glob patterns for files to exclude when publishing\n\nFiles matching these patterns will be excluded from publishing.\nExclude patterns take precedence over include patterns.\nPatterns are relative to `root` (if set) or the workspace root.\nDefault exclusions (`.git/`, `node_modules/`, etc.) are applied automatically.\n\nExample: `[\"**/*.draft.md\", \"temp/**\"]`",
          "type": [
            "array",
            "null"
          ],
          "items": {
            "type": "string"
          }
        }
      }
    },
    "ConfigRelativePath": {
      "description": "A path that is resolved relative to the configuration file it was defined in\n\nThis wrapper provides JsonSchema implementation and stores paths as strings.\nThe paths will be resolved relative to the config file directory during use.",
      "type": "string"
    },
    "RouteTarget": {
      "description": "Target for a route - either a file path or a redirect\n\nRoutes can either serve a file or redirect to another URL.\nThis enum allows for a clean representation where simple file\npaths are strings, and redirects are objects.",
      "anyOf": [
        {
          "description": "Serve a file at this path\n\nPath relative to the workspace directory (or `site.root` if configured).\n\nExample in TOML:\n```toml\n[routes]\n\"/about/\" = \"README.md\"\n```",
          "allOf": [
            {
              "$ref": "#/definitions/ConfigRelativePath"
            }
          ]
        },
        {
          "description": "Redirect to another URL\n\nExample in TOML:\n```toml\n[routes]\n\"/old/\" = { redirect = \"/new/\", status = 301 }\n```",
          "allOf": [
            {
              "$ref": "#/definitions/RouteRedirect"
            }
          ]
        }
      ]
    },
    "RouteRedirect": {
      "description": "A redirect configuration",
      "type": "object",
      "properties": {
        "redirect": {
          "description": "The URL to redirect to\n\nCan be an absolute URL or a relative path.\n\nExamples:\n- /new-location/ - Redirect to another path on the same site\n- https://example.com - Redirect to an external URL",
          "type": "string"
        },
        "status": {
          "description": "HTTP status code for the redirect\n\nDetermines the type of redirect. Common values:\n- 301 - Moved Permanently (permanent redirect)\n- 302 - Found (temporary redirect, default)\n- 303 - See Other\n- 307 - Temporary Redirect\n- 308 - Permanent Redirect\n\nIf not specified, defaults to 302 (temporary redirect).",
          "anyOf": [
            {
              "$ref": "#/definitions/RedirectStatus"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": [
        "redirect"
      ]
    },
    "RedirectStatus": {
      "description": "HTTP status code for redirects",
      "type": "integer",
      "enum": [
        301,
        302,
        303,
        307,
        308
      ]
    }
  },
  "$id": "https://stencila.org/stencila-config.schema.json"
}