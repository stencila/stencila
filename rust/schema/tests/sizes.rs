//! Inspect sizes of enums and their variants
//!
//! The `sizes` function is not actually a test but rather a way to check that
//! the size of an enum is not being excessively bloated by
//! the largest variants.
//!
//! Where appropriate properties of large variants should be made
//! non-core so that they are heap allocated, rather than stack
//! allocated (which means that they do no inflate the size of the enum).
//!
//! Run like this:
//!
//!   cargo test -p stencila-schema --test sizes -- --nocapture

use stencila_schema::*;

macro_rules! sizes {
    ($($t:ty),*) => {
        {
            let mut sizes: Vec<(&str, usize)> = vec![
                $((stringify!($t), std::mem::size_of::<$t>()),)*
            ];
            sizes.sort_by(|a, b| b.1.cmp(&a.1));

            for (name, size) in sizes {
                eprintln!("{:<20} {:>6}", name, size);
            }
            eprintln!("\n");
        }
    };
}

#[test]
#[allow(clippy::print_stderr)]
fn sizes() {
    sizes!(
        Node,
        Admonition,
        Annotation,
        AppendixBreak,
        Array,
        ArrayHint,
        ArrayValidator,
        Article,
        AudioObject,
        AuthorRole,
        Boolean,
        BooleanValidator,
        Brand,
        Button,
        CallArgument,
        CallBlock,
        Chat,
        ChatMessage,
        ChatMessageGroup,
        Citation,
        CitationGroup,
        Claim,
        CodeBlock,
        CodeChunk,
        CodeExpression,
        CodeInline,
        CodeLocation,
        Collection,
        Comment,
        CompilationDigest,
        CompilationMessage,
        ConstantValidator,
        ContactPoint,
        Cord,
        CreativeWork,
        Datatable,
        DatatableColumn,
        DatatableColumnHint,
        DatatableHint,
        Date,
        DateTime,
        DateTimeValidator,
        DateValidator,
        DefinedTerm,
        Directory,
        Duration,
        DurationValidator,
        Emphasis,
        Enumeration,
        EnumValidator,
        Excerpt,
        ExecutionDependant,
        ExecutionDependency,
        ExecutionMessage,
        ExecutionTag,
        Figure,
        File,
        ForBlock,
        Form,
        Function,
        Grant,
        Heading,
        IfBlock,
        IfBlockClause,
        ImageObject,
        IncludeBlock,
        InlinesBlock,
        InstructionBlock,
        InstructionInline,
        InstructionMessage,
        Integer,
        IntegerValidator,
        Island,
        Link,
        List,
        ListItem,
        MathBlock,
        MathInline,
        MediaObject,
        ModelParameters,
        MonetaryGrant,
        Note,
        Null,
        Number,
        NumberValidator,
        Object,
        ObjectHint,
        Organization,
        Paragraph,
        Parameter,
        Periodical,
        Person,
        PostalAddress,
        Product,
        Prompt,
        PromptBlock,
        PropertyValue,
        ProvenanceCount,
        PublicationIssue,
        PublicationVolume,
        QuoteBlock,
        QuoteInline,
        RawBlock,
        Reference,
        Review,
        Section,
        Sentence,
        SoftwareApplication,
        SoftwareSourceCode,
        Strikeout,
        String,
        StringHint,
        StringValidator,
        Strong,
        StyledBlock,
        StyledInline,
        Subscript,
        SuggestionBlock,
        SuggestionInline,
        Superscript,
        Supplement,
        Table,
        TableCell,
        TableRow,
        Text,
        ThematicBreak,
        Thing,
        Time,
        Timestamp,
        TimestampValidator,
        TimeValidator,
        TupleValidator,
        Underline,
        Unknown,
        UnsignedInteger,
        Variable,
        VideoObject,
        Walkthrough,
        WalkthroughStep
    );

    sizes!(
        CreativeWorkVariant,
        Article,
        CreativeWork,
        AudioObject,
        Chat,
        Claim,
        Collection,
        Comment,
        Datatable,
        Figure,
        File,
        ImageObject,
        MediaObject,
        Periodical,
        Prompt,
        PublicationIssue,
        PublicationVolume,
        Review,
        SoftwareApplication,
        SoftwareSourceCode,
        Table,
        VideoObject
    );

    sizes!(
        Block,
        Admonition,
        CallBlock,
        Chat,
        ChatMessage,
        ChatMessageGroup,
        Claim,
        CodeBlock,
        CodeChunk,
        Excerpt,
        Figure,
        ForBlock,
        Form,
        Heading,
        IfBlock,
        IncludeBlock,
        InstructionBlock,
        List,
        MathBlock,
        Paragraph,
        PromptBlock,
        QuoteBlock,
        RawBlock,
        Section,
        StyledBlock,
        SuggestionBlock,
        Supplement,
        Table,
        ThematicBreak,
        Walkthrough
    );

    sizes!(
        Inline,
        Annotation,
        AudioObject,
        Button,
        Citation,
        CitationGroup,
        CodeExpression,
        CodeInline,
        Date,
        DateTime,
        Duration,
        Emphasis,
        ImageObject,
        InstructionInline,
        Link,
        MathInline,
        MediaObject,
        Note,
        Parameter,
        QuoteInline,
        StyledInline,
        Strikeout,
        Strong,
        Subscript,
        Superscript,
        Text,
        Time,
        Timestamp,
        Underline,
        VideoObject
    );

    sizes!(
        Primitive,
        Null,
        Boolean,
        Integer,
        UnsignedInteger,
        Number,
        String,
        Array,
        Object
    );
}
